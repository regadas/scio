<html><head><title>scio: BigQuery</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="docs" /><meta name="description" content="Scio, a Scala API for Apache Beam and Google Cloud Dataflow inspired by Apache Spark and Scalding." /><meta name="og:image" content="/scio/img/poster.png" /><meta name="og:title" content="scio: BigQuery" /><meta name="og:site_name" content="scio" /><meta name="og:url" content="https://regadas.github.io/scio/" /><meta name="og:type" content="website" /><meta name="og:description" content="Scio, a Scala API for Apache Beam and Google Cloud Dataflow inspired by Apache Spark and Scalding." /><link rel="icon" type="image/png" href="/scio/img/favicon.png" /><meta name="twitter:title" content="scio: BigQuery" /><meta name="twitter:image" content="https://regadas.github.io/scio/img/poster.png" /><meta name="twitter:description" content="Scio, a Scala API for Apache Beam and Google Cloud Dataflow inspired by Apache Spark and Scalding." /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/scio/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/scio/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/scio/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/scio/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/scio/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/scio/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/scio/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/scio/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/scio/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/scio/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/scio/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/scio/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/scio/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/scio/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/scio/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/scio/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/scio/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/scio/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/scio/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/scio/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/scio/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/scio/css/style.css" /><link rel="stylesheet" href="/scio/css/palette.css" /><link rel="stylesheet" href="/scio/css/codemirror.css" /><link rel="stylesheet" href="/scio/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/scio/" class="brand"><div class="brand-wrapper"><span>scio</span></div></a></li> <li><a href="/scio/docs/index.html" class="">Getting Started</a></li> <li><a href="/scio/docs/Scio-REPL.html" class="">REPL</a></li> <li><a href="/scio/docs/Scio,-Beam-and-Dataflow.html" class="">Scio, Beam and Dataflow</a></li> <li><a href="/scio/docs/Scio,-Scalding-and-Spark.html" class="">Scio, Scalding and Spark</a></li> <li><a href="/scio/docs/Apache-Beam.html" class="">Apache Beam</a></li> <li><a href="/scio/docs/Runners.html" class="">Runners</a></li> <li><a href="/scio/docs/Scio-data-guideline.html" class="">Scio data guideline</a></li> <li><a href="/scio/docs/FAQ.html" class="">FAQ</a></li> <li><a href="/scio/docs/Powered-By.html" class="">Powered By</a></li> <li><a href="/scio/docs/HDFS.html" class="">IO</a> <ul class="sub_section"> <li><a href="/scio/docs/HDFS.html" class="">HDFS</a></li> <li><a href="/scio/docs/Avro.html" class="">Avro</a></li> <li><a href="/scio/docs/Bigtable.html" class="">Bigtable</a></li> <li><a href="/scio/docs/Protobuf.html" class="">Protobuf</a></li> <li><a href="/scio/docs/Parquet.html" class="">Parquet</a></li></ul></li> <li><a href="/scio/docs/Algebird.html" class="">Extras</a> <ul class="sub_section"> <li><a href="/scio/docs/Algebird.html" class="">Algebird</a></li></ul></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/regadas/scio"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/regadas/scio"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('scio Scio, a Scala API for Apache Beam and Google Cloud Dataflow inspired by Apache Spark and Scalding.');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('scio Scio, a Scala API for Apache Beam and Google Cloud Dataflow inspired by Apache Spark and Scalding.');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="regadas" data-github-repo="scio"><div class="content-wrapper"><section><h1 id="introduction">Introduction</h1>

<p>The <a href="https://github.com/spotify/scio/blob/master/scio-bigquery/src/main/scala/com/spotify/scio/bigquery/validation/OverrideTypeProvider.scala"><code class="highlighter-rouge">OverrideTypeProvider</code></a> trait allows the user to provide custom mappings from BigQuery types to custom Scala types.</p>

<p>This can be used for a number of use cases:</p>
<ul>
  <li>Using higher level types in Scio in order to be explicit about what your data is</li>
  <li>Custom code can be run when you create new objects to do things like data validation or simple transformation</li>
</ul>

<p>The methods in the Scala trait allow you to inspect the incoming types from BigQuery and decide if you’d like to provide an alternative type mapping to your own custom type.  You also must tell Scio how to convert your types back into BigQuery data types.</p>

<h1 id="setup">Setup</h1>

<p>Once you implement the <code class="highlighter-rouge">OverrideTypeProvider</code> with your own custom types you can supply it to the <code class="highlighter-rouge">OverrideTypeProviderFinder</code> by specifying a JVM System property as below.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="n">setProperty</span><span class="o">(</span>
  <span class="s">"OVERRIDE_TYPE_PROVIDER"</span><span class="o">,</span>
  <span class="s">"com.spotify.scio.bigquery.validation.SampleOverrideTypeProvider"</span><span class="o">)</span>
</code></pre></div></div>

<p>Since this feature uses Scala macros you must do this at initialization time.  One easy way to do this is in the <code class="highlighter-rouge">build.sbt</code> file for your project.  This would look like below.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">initialize</span> <span class="n">in</span> <span class="nc">Test</span> <span class="o">~=</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="n">setProperty</span><span class="o">(</span>
  <span class="s">"OVERRIDE_TYPE_PROVIDER"</span><span class="o">,</span>
  <span class="s">"com.spotify.scio.bigquery.validation.SampleOverrideTypeProvider"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Currently only one <code class="highlighter-rouge">OverrideTypeProvider</code> is allowed per sbt project.</p>

<p>This provider is loaded using Reflection at macro expansion time and at runtime as well.</p>

<p>If this System property isn’t specified then Scio falls back to the normal default behavior.</p>

<h1 id="implementation">Implementation</h1>

<p>Custom implementations of the <code class="highlighter-rouge">OverrideTypeProvider</code> should implement the methods as described below.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">shouldOverrideType</span><span class="o">(</span><span class="n">tfs</span><span class="k">:</span> <span class="kt">TableFieldSchema</span><span class="o">)</span>
</code></pre></div></div>
<ul>
  <li>This is the first point of entry and is called when we use macros to create case classes for <code class="highlighter-rouge">fromQuery</code>, <code class="highlighter-rouge">fromSchema</code>, and <code class="highlighter-rouge">fromTable</code>.</li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">getScalaType</span><span class="o">(</span><span class="n">c</span><span class="k">:</span> <span class="kt">blackbox.Context</span><span class="o">)(</span><span class="n">tfs</span><span class="k">:</span> <span class="kt">TableFieldSchema</span><span class="o">)</span>
</code></pre></div></div>
<ul>
  <li>This is called when the above <code class="highlighter-rouge">shouldOverrideType</code> returns <code class="highlighter-rouge">true</code>.  Expected return value is a <code class="highlighter-rouge">c.Tree</code> representing the Scala type you’d like to use for this mapping.</li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">shouldOverrideType</span><span class="o">(</span><span class="n">c</span><span class="k">:</span> <span class="kt">blackbox.Context</span><span class="o">)(</span><span class="n">tpe</span><span class="k">:</span> <span class="kt">c.Type</span><span class="o">)</span>
</code></pre></div></div>
<ul>
  <li>This is called when we do conversions to and from a <code class="highlighter-rouge">TableRow</code> internally and your generated case class.</li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">createInstance</span><span class="o">(</span><span class="n">c</span><span class="k">:</span> <span class="kt">blackbox.Context</span><span class="o">)(</span><span class="n">tpe</span><span class="k">:</span> <span class="kt">c.Type</span><span class="o">,</span> <span class="n">tree</span><span class="k">:</span> <span class="kt">c.Tree</span><span class="o">)</span>
</code></pre></div></div>
<ul>
  <li>This is called when the above <code class="highlighter-rouge">shouldOverrideType</code> returns <code class="highlighter-rouge">true</code>.  Expected return value is a <code class="highlighter-rouge">c.Tree</code> representing how to create a new instance of your custom Scala type.</li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">shouldOverrideType</span><span class="o">(</span><span class="n">tpe</span><span class="k">:</span> <span class="kt">Type</span><span class="o">)</span>
</code></pre></div></div>
<ul>
  <li>This is called at runtime when we do any operations on the schema directly.</li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">getBigQueryType</span><span class="o">(</span><span class="n">tpe</span><span class="k">:</span> <span class="kt">Type</span><span class="o">)</span>
</code></pre></div></div>
<ul>
  <li>This is called when the above <code class="highlighter-rouge">shouldOverrideType</code> returns <code class="highlighter-rouge">true</code>.  It should return the <code class="highlighter-rouge">String</code> representation for the BigQuery column type for your class and field now.</li>
</ul>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">initializeToTable</span><span class="o">(</span><span class="n">c</span><span class="k">:</span> <span class="kt">blackbox.Context</span><span class="o">)(</span><span class="n">modifiers</span><span class="k">:</span> <span class="kt">c.universe.Modifiers</span><span class="o">,</span>
                                           <span class="n">variableName</span><span class="k">:</span> <span class="kt">c.universe.TermName</span><span class="o">,</span>
                                           <span class="n">tpe</span><span class="k">:</span> <span class="kt">c.universe.Tree</span><span class="o">)</span>
</code></pre></div></div>
<ul>
  <li>This is called once per field when we extend the case classes for <code class="highlighter-rouge">toTable</code> examples.</li>
</ul>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/scio/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script>((window.gitter = {}).chat = {}).options = {
room: 'regadas/scio'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/scio/js/main.js"></script></body></html>